<!doctype html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KB Pure Breath â€” KL AQI Live</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{--accent1:#2bb6b6;--accent2:#4aa0e6;--muted:#6b7280;--maxw:1100px}
  *{box-sizing:border-box}body{margin:0;font-family:Inter,Poppins,system-ui;background:#f6fbff;color:#071129;line-height:1.4;padding-bottom:120px}
  .hero{min-height:260px;background:url('https://us.images.westend61.de/0001599644pw/malaysia-kuala-lumpur-clouds-over-klcc-park-and-petronas-towers-EAF00105.jpg') center/cover no-repeat;color:#fff;display:flex;align-items:center}
  .overlay{width:100%;background:linear-gradient(180deg,rgba(6,21,34,0.55),rgba(6,21,34,0.25));padding:28px 5%}
  .wrap{max-width:var(--maxw);margin:0 auto;display:flex;justify-content:space-between;align-items:center}
  .brand{display:flex;gap:14px;align-items:center}.logo{width:56px;height:56px;border-radius:8px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-weight:700}
  nav a{color:#fff;text-decoration:none;margin-left:12px;padding:6px 10px;border-radius:8px;font-weight:600}
  main{max-width:var(--maxw);margin:16px auto;padding:0 16px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
  .card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  .pm-row{display:flex;gap:10px;flex-wrap:wrap}
  .pm{flex:1 1 180px;padding:10px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid rgba(10,20,40,0.03)}
  .pm .val{font-size:28px;font-weight:700;color:var(--accent2)}
  .charts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  canvas{width:100%;height:220px!important}
  .ipu{margin-top:12px;padding:10px;border-radius:8px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;display:flex;justify-content:space-between;align-items:center}
  section{margin-top:18px}
  .inf{display:flex;gap:12px;flex-wrap:wrap}.info{flex:1 1 250px;background:#fff;padding:12px;border-radius:8px}
  .research a{color:var(--accent2);font-weight:600}
  .team{display:flex;gap:8px;flex-wrap:wrap}.member{background:#fff;padding:10px;border-radius:8px;min-width:160px}
  footer{text-align:center;color:var(--muted);margin:18px 0}
  .chat{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;padding:10px 14px;border-radius:999px;text-decoration:none;font-weight:700;z-index:9999}
  @media(max-width:900px){.grid{grid-template-columns:1fr}.charts{grid-template-columns:1fr}.wrap{flex-direction:column;align-items:flex-start}nav{display:none}}
</style>
</head>
<body>
  <header class="hero" role="banner">
    <div class="overlay">
      <div class="wrap">
        <div class="brand">
          <div class="logo">KB</div>
          <div>
            <h1 style="margin:0;font-size:20px">KB Pure Breath</h1>
            <div style="font-size:13px;color:rgba(255,255,255,0.9)">Live air quality â€” Kuala Lumpur</div>
          </div>
        </div>
        <nav aria-label="Main"><a href="#live">Live</a><a href="#research">Kajian</a><a href="#infografik">Infografik</a><a href="#faq">FAQ</a><a href="#about">About</a></nav>
      </div>
    </div>
  </header>

  <main>
    <section id="live" class="grid" aria-labelledby="live">
      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start">
          <div style="flex:1">
            <div style="font-size:13px;color:var(--muted)">Particulate Matter (Latest)</div>
            <div class="pm-row" style="margin-top:8px">
              <div class="pm"><div style="font-size:13px;color:var(--muted)">PM2.5 (Âµg/mÂ³)</div><div id="pm25" class="val">--</div><div id="t25" style="font-size:12px;color:var(--muted)"></div></div>
              <div class="pm"><div style="font-size:13px;color:var(--muted)">PM10 (Âµg/mÂ³)</div><div id="pm10" class="val">--</div><div id="t10" style="font-size:12px;color:var(--muted)"></div></div>
            </div>
          </div>

          <aside style="min-width:220px">
            <div style="font-size:13px;color:var(--muted)">Indeks Pencemaran Udara (AQI) - Live</div>
            <div id="ipu" class="ipu"><div><div id="aqival" style="font-size:26px;font-weight:800">--</div><div id="aqitxt" style="font-size:13px"></div></div><div style="font-size:12px;text-align:right">Updated<br><span id="aqitime">--</span></div></div>
          </aside>
        </div>

        <div class="charts">
          <div class="card chart-card"><div style="font-weight:700">Trend PM2.5</div><canvas id="c25" aria-label="pm25"></canvas></div>
          <div class="card chart-card"><div style="font-weight:700">Trend PM10</div><canvas id="c10" aria-label="pm10"></canvas></div>
        </div>

        <div style="margin-top:12px"><div class="card" style="background:linear-gradient(180deg,#fff,#fbfdff)"><strong>Real-time details</strong><div id="details" style="color:var(--muted);margin-top:6px">--</div></div></div>
      </div>

      <aside>
        <div class="card">
          <div style="font-size:13px;color:var(--muted)">Live station</div><div style="font-weight:700">Kuala Lumpur (AQICN)</div>
          <p style="color:var(--muted);font-size:13px">Data: aqicn.org â€” jika tiada data, API mungkin tiada bacaan atau blocked by CORS.</p>
          <hr>
          <div style="font-size:13px"><strong>Tips</strong><ul style="padding-left:18px;margin:6px 0;color:var(--muted)"><li>Gunakan N95 bila AQI tinggi</li><li>Kurangkan aktiviti luar semasa haze</li></ul></div>
        </div>
      </aside>
    </section>

    <section id="infografik" class="section">
      <h2>Infografik: Kesan Particulate Matter ke Sistem Respiratori</h2>
      <div class="inf">
        <div class="info"><strong>PM2.5</strong><p style="color:var(--muted)">Partikel halus yang boleh menembusi alveoli, berkaitan asma, bronkitis dan masalah kardiovaskular.</p></div>
        <div class="info"><strong>PM10</strong><p style="color:var(--muted)">Partikel lebih besar, mengiritasi saluran pernafasan atas dan bronkus.</p></div>
        <div class="info"><strong>Prevention</strong><p style="color:var(--muted)">Topeng, kawal sumber pencemaran, pantau bacaan AQI.</p></div>
      </div>
    </section>

    <section id="research" class="section research">
      <h2>Kajian Tempatan</h2>
      <div class="card">
        <p style="color:var(--muted);margin:0 0 8px">Rujukan (Prof. Dr. Juliana binti Jalaludin):</p>
        <a href="https://www.tandfonline.com/doi/abs/10.1080/02786826.2025.2502492" target="_blank" rel="noopener">Baca artikel Prof. Juliana (2025) â†—</a>
        <div style="margin-top:10px;color:var(--muted)"><strong>Profil:</strong> Prof. Dr. Juliana binti Jalaludin â€” Fakulti Perubatan & Sains Kesihatan, UPM. Penyelidik dalam kesan pencemaran udara terhadap kesihatan pernafasan. <a href="https://profile.upm.edu.my/juliana/profesional.html" target="_blank">Profil UPM â†—</a></div>
      </div>
    </section>

    <section id="faq" class="section">
      <h2>FAQ</h2>
      <div class="card">
        <div style="cursor:pointer" onclick="toggle(this)">Apa itu PM2.5 & PM10?</div>
        <div style="display:none;color:var(--muted);margin-top:8px">PM2.5 = <2.5Âµm, PM10 = <10Âµm. PM2.5 lebih berbahaya kerana boleh memasuki alveoli.</div>
        <div style="cursor:pointer;margin-top:8px" onclick="toggle(this)">Bagaimana AQI dikira?</div>
        <div style="display:none;color:var(--muted);margin-top:8px">AQI berdasarkan beberapa param; AQICN menyediakan nilai berasaskan stesen pemantauan setempat.</div>
      </div>
    </section>

    <section id="about" class="section">
      <h2>About / Contact</h2>
      <div class="card team">
        <div class="member"><strong>Iqbal</strong><div style="color:var(--muted)">+60179912306</div></div>
        <div class="member"><strong>Syakirullah</strong><div style="color:var(--muted)">+60172131363</div></div>
        <div class="member"><strong>Wan Zulkhairi</strong><div style="color:var(--muted)">+60145147998</div></div>
        <div class="member"><strong>Zhafri</strong><div style="color:var(--muted)">+60138487104</div></div>
        <div class="member"><strong>Zie Ain Balqis</strong><div style="color:var(--muted)">+60172370158</div></div>
      </div>
    </section>
  </main>

  <footer>Â© KB Pure Breath â€” Data source: AQICN (waqi.info)</footer>

  <a class="chat" href="https://wa.me/18772241042" target="_blank" rel="noopener">ðŸ’¬ Chat Copilot</a>

<script>
/* compact JS: AQICN fetch + charts + UI update */
const TOKEN="ae042b2540f9d68b5f09af2ab8fa7b28b58ad821";
const URL=`https://api.waqi.info/feed/kuala+lumpur/?token=${TOKEN}`;
const interval=60_000, history=24;
let tLabels=[], d25=[], d10=[];
const ctx25=document.getElementById('c25').getContext('2d');
const ctx10=document.getElementById('c10').getContext('2d');
const chart25=new Chart(ctx25,{type:'line',data:{labels:tLabels,datasets:[{label:'PM2.5',data:d25,tension:.3,borderColor:getComputedStyle(document.documentElement).getPropertyValue('--accent2')||'#4aa0e6',fill:true,backgroundColor:'rgba(74,160,230,0.08)'}]},options:{responsive:true,maintainAspectRatio:false}});
const chart10=new Chart(ctx10,{type:'line',data:{labels:tLabels,datasets:[{label:'PM10',data:d10,tension:.3,borderColor:getComputedStyle(document.documentElement).getPropertyValue('--accent1')||'#2bb6b6',fill:true,backgroundColor:'rgba(43,182,182,0.06)'}]},options:{responsive:true,maintainAspectRatio:false}});

function updateUI(aqi,pm25,pm10,time){
  document.getElementById('aqival').textContent = aqi ?? '--';
  document.getElementById('aqitxt').textContent = aqi===null? 'No data' : (aqi<=50?'Good':aqi<=100?'Moderate':aqi<=150?'Unhealthy (S)':'Unhealthy');
  document.getElementById('aqitime').textContent = time? new Date(time).toLocaleString() : new Date().toLocaleString();
  document.getElementById('pm25').textContent = pm25!==null? pm25.toFixed(1):'--';
  document.getElementById('pm10').textContent = pm10!==null? pm10.toFixed(1):'--';
  if(time){document.getElementById('t25').textContent=document.getElementById('t10').textContent=new Date(time).toLocaleString();}
  document.getElementById('details').textContent = `AQI: ${aqi ?? '--'} â€¢ PM2.5: ${pm25!==null?pm25.toFixed(1):'--'} Âµg/mÂ³ â€¢ PM10: ${pm10!==null?pm10.toFixed(1):'--'}.`;
}

async function fetchAQI(){
  try{
    const r=await fetch(URL);
    const j=await r.json();
    if(!j || j.status!=='ok' || !j.data){document.getElementById('details').textContent='API error or no data (CORS may block).'; return;}
    const aqi = Number.isFinite(+j.data.aqi)? +j.data.aqi : null;
    const iaqi=j.data.iaqi||{};
    const pm25=iaqi.pm25? Number(iaqi.pm25.v) : (j.data.forecast&&j.data.forecast.daily&&j.data.forecast.daily.pm25? j.data.forecast.daily.pm25[0].avg : null);
    const pm10=iaqi.pm10? Number(iaqi.pm10.v) : (j.data.forecast&&j.data.forecast.daily&&j.data.forecast.daily.pm10? j.data.forecast.daily.pm10[0].avg : null);
    const t = j.data.time && j.data.time.s ? j.data.time.s : new Date().toISOString();

    if(tLabels.length>=history){ tLabels.shift(); d25.shift(); d10.shift(); }
    tLabels.push(new Date(t).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}));
    d25.push(pm25===null?null:pm25); d10.push(pm10===null?null:pm10);
    chart25.update(); chart10.update();
    updateUI(aqi,pm25,pm10,t);
  }catch(e){
    console.warn('fetch error',e);
    document.getElementById('details').textContent='Gagal ambil data AQICN. Jika CORS error, gunakan proxy.';
  }
}

window.addEventListener('DOMContentLoaded',()=>{
  // seed labels
  for(let i=history-1;i>=0;i--){ const dt=new Date(Date.now()-i*60000); tLabels.push(dt.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})); d25.push(null); d10.push(null); }
  chart25.update(); chart10.update();
  fetchAQI();
  setInterval(fetchAQI, interval);
});

function toggle(el){
  const a = el.nextElementSibling;
  if(!a) return;
  a.style.display = (a.style.display==='block') ? 'none' : 'block';
}
</script>
</body>
</html>
