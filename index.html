<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KB Pure Breath — Live AQI KL (Restored)</title>
  <meta name="description" content="KB Pure Breath - Live Air Quality monitoring Kuala Lumpur (OpenAQ) - PM2.5, PM10" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --accent1:#2bb6b6;
      --accent2:#4aa0e6;
      --muted:rgba(15,23,42,0.7);
      --glass-bg: rgba(255,255,255,0.06);
      --card-bg: rgba(255,255,255,0.92);
      --text-on-glass: rgba(255,255,255,0.95);
      --maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, Poppins, system-ui; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    body{
      background-image: url('klcc-bg.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color:#071129;
      padding-bottom:120px;
    }
    .page-overlay{
      position:fixed; inset:0; background:linear-gradient(180deg, rgba(6,21,34,0.48), rgba(6,21,34,0.32)); z-index:0;
      pointer-events:none;
    }
    .page{ position:relative; z-index:2; max-width:var(--maxw); margin:0 auto; padding:28px; }
    header{ display:flex; align-items:center; gap:16px; margin-bottom:18px; flex-wrap:wrap;}
    .logo{ width:110px; height:110px; border-radius:14px; overflow:hidden; box-shadow:0 12px 40px rgba(0,0,0,0.35); background:var(--glass-bg); flex:0 0 110px; }
    .logo img{ width:100%; height:100%; object-fit:contain; display:block; }
    .site-title{ color:var(--text-on-glass) }
    .site-title h1{ margin:0; font-size:26px; font-weight:700; text-shadow:0 2px 6px rgba(0,0,0,0.35) }
    .site-title p{ margin:4px 0 0 0; color:rgba(255,255,255,0.9); font-size:13px; }
    nav{ margin-left:auto; display:flex; gap:10px; align-items:center; }
    nav a{ color:rgba(255,255,255,0.95); text-decoration:none; padding:8px 10px; border-radius:8px; font-weight:600; }
    nav a:hover{ background: rgba(255,255,255,0.06); }
    .glass{ background:var(--glass-bg); border-radius:12px; padding:14px; color:var(--text-on-glass); backdrop-filter: blur(6px) saturate(110%); -webkit-backdrop-filter: blur(6px) saturate(110%); box-shadow:0 8px 30px rgba(0,0,0,0.25) }
    .realtime{ display:grid; grid-template-columns: 1fr 380px; gap:18px; align-items:start; margin-bottom:18px; }
    .aqi-big{ padding:18px; border-radius:12px; color:var(--text-on-glass); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow:0 12px 36px rgba(0,0,0,0.45) }
    .aqi-value{ font-size:72px; font-weight:800; margin:10px 0; letter-spacing:-1px }
    .aqi-cat{ font-size:18px; margin-top:6px; color:rgba(255,255,255,0.95) }
    .aqi-meta{ margin-top:8px; color:rgba(255,255,255,0.85); font-size:13px }
    .side{ background:var(--card-bg); color:#071129; border-radius:12px; padding:12px; box-shadow:0 8px 24px rgba(2,6,23,0.12); min-height:220px; }
    .chart-wrap{ height:220px; position:relative; }
    .pm-row{ display:flex; gap:12px; margin-top:12px; flex-wrap:wrap }
    .pm-box{ flex:1 1 120px; padding:10px; border-radius:10px; background:rgba(255,255,255,0.06); color:var(--text-on-glass); text-align:center }
    @media(max-width:980px){
      .realtime{ grid-template-columns:1fr }
      .contact-grid{ grid-template-columns:1fr }
      header{ gap:12px }
      .aqi-value{ font-size:48px }
      .chart-wrap{ height:180px }
    }
  </style>
</head>
<body>
  <div class="page-overlay" aria-hidden="true"></div>
  <main class="page" role="main">
    <header>
      <div class="logo" aria-hidden="true">
        <img src="logo.png" alt="KB Pure Breath logo" onerror="this.style.display='none'">
      </div>
      <div class="site-title">
        <h1>KB Pure Breath</h1>
        <p>Live Air Quality Monitoring — Kuala Lumpur</p>
      </div>
      <nav aria-label="Main navigation">
        <a href="#realtime">Realtime</a>
        <a href="#infographic">Infographic</a>
        <a href="#about">Hubungi Kami</a>
        <a href="#poster">Poster Awareness</a>
        <a href="#faq">FAQ</a>
      </nav>
    </header>
    <!-- Realtime -->
    <section id="realtime" class="realtime" aria-labelledby="realtime-heading">
      <div class="aqi-big glass" id="aqiCard" role="region" aria-labelledby="realtime-heading">
        <h2 id="realtime-heading" style="margin:0 0 10px 0">Realtime Air Quality Index (AQI)</h2>
        <div class="aqi-value" id="aqiValue">--</div>
        <div class="aqi-cat" id="aqiCategory">Loading...</div>
        <div class="aqi-meta" id="aqiMeta">Last updated: --</div>
        <div class="pm-row">
          <div class="pm-box" id="pm25Box">PM2.5: -- µg/m³</div>
          <div class="pm-box" id="pm10Box">PM10: -- µg/m³</div>
        </div>
      </div>
      <aside class="side" aria-labelledby="charts-heading">
        <div id="charts-heading" style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700;color:#0f172a">Particulate Matter Trend</div>
          <div style="font-size:12px;color:var(--muted)">Recent readings</div>
        </div>
        <div class="chart-wrap" style="margin-top:12px">
          <canvas id="pmChart" aria-label="PM2.5 and PM10 trend" role="img"></canvas>
        </div>

        <!-- AQICN Forecast Embed -->
        <div style="margin-top:18px">
          <iframe src="https://aqicn.org/forecast/kuala-lumpur/" width="100%" height="600" style="border:none;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.2)" title="AQICN Forecast"></iframe>
        </div>
        <div style="margin-top:12px;font-size:13px;color:var(--muted)">
          Note: If numbers don't appear, proxy or API may be rate-limited — open DevTools Console.
        </div>
      </aside>
    </section>
    <!-- Infographic -->
    <section id="infographic" class="glass" style="margin-top:18px;padding:16px" aria-labelledby="infog">
      <h2 id="infog" style="margin:0 0 10px 0;color:var(--text-on-glass)">Infographic — Respiratory Tract & Particulate Matter</h2>
      <div style="text-align:center">
        <img src="https://www.researchgate.net/profile/Fiorella-Barraza/publication/321993233/figure/fig14/AS:574185194704903@1513907826653/Respiratory-tract-and-particulate-matter-PM-size-classification-Modified-from.png" alt="Respiratory tract and PM" style="max-width:100%;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.25)">
      </div>
    </section>

    <!-- Contact + Complain -->
    <section id="about" style="margin-top:18px">
      <div class="contact-grid">
        <div class="glass">
          <h3 style="margin-top:0">Hubungi Kami</h3>
          <p>Untuk pertanyaan lanjut atau cadangan, sila hubungi kami melalui:</p>
          <ul>
            <li>Email: <a href="mailto:info@kbpurebreath.org">info@kbpurebreath.org</a></li>
            <li>WhatsApp: <a href="https://wa.me/60123456789" target="_blank">+60 12-345 6789</a></li>
          </ul>
        </div>
        <div class="glass">
          <h3 style="margin-top:0">Aduan & Cadangan</h3>
          <p>Kami mengalu-alukan maklum balas anda untuk penambahbaikan dashboard ini.</p>
          <form>
            <label for="feedback">Maklum balas:</label><br>
            <textarea id="feedback" name="feedback" rows="4" style="width:100%;border-radius:8px;padding:8px"></textarea><br><br>
            <button type="submit" style="padding:8px 16px;border:none;border-radius:8px;background:var(--accent1);color:white;font-weight:600">Hantar</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Poster Awareness -->
    <section id="poster" style="margin-top:18px">
      <h2 style="color:var(--text-on-glass);margin:0 0 10px 0">Poster Awareness</h2>
      <div class="poster-grid">
        <div class="poster-card"><img src="poster%201.png" alt="Poster 1"></div>
        <div class="poster-card"><img src="poster%202.png" alt="Poster 2"></div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" style="margin-top:18px">
      <h2 style="color:var(--text-on-glass);margin:0 0 10px 0">FAQ — Kesan Particulate Matter terhadap Kesihatan</h2>
      <div class="faq">
        <details>
          <summary>Apa itu PM2.5 dan PM10?</summary>
          <p>PM2.5 dan PM10 ialah zarah halus dalam udara yang boleh menjejaskan kesihatan pernafasan.</p>
        </details>
        <details>
          <summary>Bagaimana PM memberi kesan kepada paru-paru?</summary>
          <p>Zarah halus boleh masuk jauh ke dalam paru-paru dan menyebabkan keradangan serta penyakit kronik.</p>
        </details>
        <details>
          <summary>Siapa yang paling terjejas?</summary>
          <p>Kanak-kanak, warga emas, dan individu dengan penyakit pernafasan lebih berisiko.</p>
        </details>
      </div>
    </section>

    <footer>© 2025 KB Pure Breath • Built for public monitoring</footer>
  </main>

  <!-- floating WhatsApp copilot -->
  <a class="wa-btn" href="https://wa.me/18772241042" target="_blank" rel="noopener noreferrer" style="position:fixed;right:18px;bottom:18px;z-index:999">Chat Copilot</a>

  <!-- SCRIPT: realtime fetch + chart + accordion -->
  <script>
    (function(){
      async function fetchAQI(){
        try {
          const res = await fetch('/api/airquality');
          const data = await res.json();
          document.getElementById('aqiValue').textContent = data.aqi;
          document.getElementById('aqiCategory').textContent = data.category;
          document.getElementById('aqiMeta').textContent = 'Last updated: ' + data.updated;
          document.getElementById('pm25Box').textContent = 'PM2.5: ' + data.pm25 + ' µg/m³';
          document.getElementById('pm10Box').textContent = 'PM10: ' + data.pm10 + ' µg/m³';

          const ctx = document.getElementById('pmChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: data.trend.labels,
              datasets: [
                {
                  label: 'PM2.5',
                  data: data.trend.pm25,
                  borderColor: '#2bb6b6',
                  fill: false
                },
                {
                  label: 'PM10',
                  data: data.trend.pm10,
                  borderColor: '#4aa0e6',
                  fill: false
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true }
              },
              scales: {
                y: { beginAtZero: true }
              }
            }
          });
        } catch (err) {
          console.error('Error fetching AQI data:', err);
        }
      }

      fetchAQI();

      document.querySelectorAll('details').forEach((el) => {
        el.addEventListener('toggle', () => {
          if (el.open) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });
    })();
  </script>
</body>
</html>
  <!-- floating WhatsApp copilot -->
  <a class="wa-btn" href="https://wa.me/18772241042" target="_blank" rel="noopener noreferrer" style="position:fixed;right:18px;bottom:18px;z-index:999">Chat Copilot</a>

  <!-- SCRIPT: realtime fetch + chart + accordion -->
  <script>
    (function(){
      async function fetchAQI(){
        try {
          const res = await fetch('/api/airquality');
          const data = await res.json();
          document.getElementById('aqiValue').textContent = data.aqi;
          document.getElementById('aqiCategory').textContent = data.category;
          document.getElementById('aqiMeta').textContent = 'Last updated: ' + data.updated;
          document.getElementById('pm25Box').textContent = 'PM2.5: ' + data.pm25 + ' µg/m³';
          document.getElementById('pm10Box').textContent = 'PM10: ' + data.pm10 + ' µg/m³';

          const ctx = document.getElementById('pmChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: data.trend.labels,
              datasets: [
                {
                  label: 'PM2.5',
                  data: data.trend.pm25,
                  borderColor: '#2bb6b6',
                  fill: false
                },
                {
                  label: 'PM10',
                  data: data.trend.pm10,
                  borderColor: '#4aa0e6',
                  fill: false
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true }
              },
              scales: {
                y: { beginAtZero: true }
              }
            }
          });
        } catch (err) {
          console.error('Error fetching AQI data:', err);
        }
      }

      fetchAQI();

      document.querySelectorAll('details').forEach((el) => {
        el.addEventListener('toggle', () => {
          if (el.open) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });
    })();
  </script>
</body>
</html>
